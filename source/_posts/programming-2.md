---
title: 重学编程(2)-设计游戏
date: 2021-09-01 22:08:09
tags:
- 重学编程系列
categories:
- 编程
- 游戏
---

>你好！
我是千无，接下来的日子里，我会不定时更新[重学编程系列](https://miyoosan.github.io/article/tags/重学编程系列/)的文章。
这是该系列的第2篇：[重学编程(2)-设计游戏](https://miyoosan.github.io/article/2021/09/01/programming-2/)。

上篇结尾时我提到，做整个游戏架构之前，可以先考虑下面三个问题：

* 网络游戏是什么？
* 这款武侠MUD需要哪些能力？
* 怎么用编程语言去实现它？

现在，让我来尝试回答一下。

## 网络游戏是什么？

网络游戏，首先是一种游戏。

我们简单认为，游戏是一种遵循了特定规则的行为活动，是规则的集合体。而网络游戏，就是描述了更具体的规则的一种游戏。

其中，网络规则约束了游戏。

那网络是什么？

我们来看看两张图，获取对网络最直观的感受：

![人际关系网络](../../../../images/imgs-2/network.jpeg)
![中国铁路主干线](../../../../images/imgs-2/networks.jpeg)

从北京出发，途径一个个城市，游遍全国，最后可以再次回到北京，这是一种网络，而且网络中的节点（城市）与节点（城市）之间的关系，被实质化成了铁路，看得见摸得着。

相反，人际关系网络里，关系都是看不见摸不着的，身处其中你可以深切感受到它的存在，置身其外大概只能画条线加些描述来表示它，谁是谁的谁谁谁，比如：云天青是柳梦璃的挚友(云天河)的父亲...

这两种截然不同的网络里，存在着相同的特点，也就是网络的基本特征：一个网络里，至少包含两个节点，节点与节点之间是多对多的关系，两个节点之间，可以有无数种关系。

同时，我们应该意识到，<font color="OliveDrab">网络是一种时空结构，遵守基本的时空规则，即节点与节点之间有时空距离，节点之间如果要传递消息，那么消息由谁携带，要付出什么代价，以及消息经过的空间距离长短与消耗的时间多少，都是需要我们特别注意的。</font>

在节点数量非常多的网络游戏里，如何合理的设计节点与节点之间的关系，是一个中心问题，比如玩家角色与游戏NPC之间，玩家角色与玩家角色之间，玩家与物品之间，剧情与物品之间，它们的关系可以是怎样的？

要探究这个问题，并提出合适的解决方案，我们得详细定义网络游戏中的“游戏”，也就是游戏基本规则。在这里，就是对《武林大侠》提出最核心功能的诉求。

## 这款武侠MUD需要哪些能力？

最核心的几个能力，我一一列了出来。
1. 联网：
首先，既然是MUD，它就不是一个单机游戏，因此，它要允许玩家联网，在同一个武林江湖里闯荡。
2. 互动：
其次，玩家之间应该可以进行一些互动，比如交谈、交易、请教，不然就是假MUD。当然，玩家与游戏NPC，甚至游戏NPC与游戏NPC之间，也可以有互动。
3. 成长体系：
作为武侠游戏，属性加点，学习武功，打怪升级，称号进阶都是常见诉求。
4. 战斗体系：
武侠游戏怎能没有战斗？比如切磋比试，惩奸除恶，挑战BOSS等。
5. 经济体系：
穷文富武，没钱寸步难行，物品、银两、经验、潜能都是玩家的财产，是支撑游戏角色成长的必需品，这些东西都可以从江湖历练中获取。
6. 剧情：
没有剧情的武侠MUD简直没有灵魂，我们需要至少一条世界主线，最好能有丰富的剧情设计，让游戏变得更好玩。
7. 基础功能：
主要方便测试，比如存档、读档、重置游戏。

对照上一篇文章的游戏设计稿，可以联想到更多的能力，那些可以是次要的，或主要的，留到我们具体实现的时候去进一步考虑。
接下来，让我们先看看怎么实现这款游戏。

## 怎么用编程语言去实现它？

到目前为止，我们基本理清了游戏基本规则，可以尝试去定义这个游戏，提出可能会遇到的问题，然后给出初步的解决方案，并落地实施，即搭建环境，编写代码，打通游戏开发的基本流程。

<font color="OliveDrab">其中最基本的一个流程，是注册登录，这需要我们提供交互界面，玩家输入账号密码后，通过网络把这些信息传输到服务器保存起来。

登录后，玩家创建角色，闯关地图，推动游戏剧情，修炼获得经验物品，提升武功/角色属性，一个个事件活动进行着，直到退出游戏时，世界就像被按了时间暂停键，一切静止。等到下次再进游戏时，一切都还在，世界又活了过来。</font>

为了更逼真，我们可以模拟现实世界，这样就算角色退出游戏，角色依然还在活动，游戏世界也在变化。

好，这款游戏在我们心中已经成型，可以想想会遇到什么问题了。

1. 首先是注册登录。为了保证玩家隐私安全，这个过程最好是全程加密的，比如走HTTPS，但在开发初期，我们可以只用HTTP，等游戏上线的时候再上HTTPS。

2. 玩家可以创建各种角色，武林里有各种NPC角色，可以把它们都当做是一大类角色，只不过NPC是我们自己创建的，能进行的活动跟玩家角色有相同的（比如战斗、成长），也有不一样的（比如玩家可以穿越、NPC不能），因此需要进一步细分，并且允许玩家充当NPC这一转换路径。

3. 地图与剧情是需要我们预先设计好的，如果想让这个游戏世界变得更开放，我们可以允许玩家改变剧情甚至地图，这意味着我们在设计的时候，要留有余地，允许玩家参与创造和破坏。

4. <font color="OliveDrab">不管是经验物品还是武功属性，这些其实都是角色的身外之物，但又实实在在体现着角色对世界、世界对角色的当前影响力，角色本身可以看作是它参与的历史事件活动的综合体，这些身外之物是它介入现实游戏世界的通道，也就是受游戏规则束缚。</font>我们可以尽可能细致地编写这些规则，规则越多，通道越稳固，角色与世界链接的更紧密，它就越鲜活。

5. 角色活动产生的事件是发散性的，不可逆的，这会永久影响直接接触与间接接触这些事件活动的其他角色，但事件本身是有局限性的，有一个被约束的发散范围，因此我们要定义好这个范围，先定一系列初始值，后续不断调整，直到表现符合我们的预期。

6. 作为虚拟世界，经济体系如果不好好设计与维护，其实很容易崩溃，进而导致整个虚拟世界体系崩坏，我们最好参考现实的一些经济模型来做好这方面的工作，有时为了简化还可以参考成熟游戏的相关设计。成长体系、战斗体系也是类似。

7. 不是所有游戏物品都有经济价值，它们还可以是精神象征，荣誉象征，个性符号等等，这些物品大部分需要与剧情相关联来引导玩家参与剧情、推动剧情，需要我们仔细去确定，去设计。一次性全部设计完不太现实，我们只需要设计主要的物品，留足扩展空间，就可以在开发中逐步去完善它。

以上主要是列举了一些业务上的问题，接下来我们看两个技术问题。

* 第一个技术问题，就是：我们用什么编程语言去开发这款游戏？
回答是：Typescript，简称TS。
在我心中的开发规划里，第一版游戏的客户端是跑在浏览器里的，玩家打开浏览器就能登录游玩，当然，实际上在手机里玩会更方便，但从技术演进角度来看，后面再迭代支持手机端也比较容易。
<font color="OliveDrab">如果一开始就上手机端，涉及的东西就有点多了，不符合我重学编程的循序渐进的思路。</font>
TS编写的程序，编译成JS后，可以跑在浏览器里，可以跑在服务器的Node.js环境上，前端后端统一技术栈，门槛低，容易上手。其实直接用JS也不是不可以，但JS缺少类型信息，会导致维护起来比较麻烦，我很难完整回忆起三五个月前编写的程序代码都做了些什么，而如果使用TS，它可以明确无误的告诉我，这里或那里该使用什么特性或功能。
<font color="OliveDrab">我比较懒，为了维护省事，就用TS了。</font>

* 第二个技术问题，是我们至少需要开发一个客户端(在浏览器运行)与一个服务端(在服务器运行)的应用，两端之间该怎么通信？
这其实包含三个子问题：
  1. 客户端的静态资源(比如html、js、css、图片等文件)一般是通过HTTP传输的，音频视用途而定，这里我们一般用HTTP就够了。
  2. 游戏角色的活动信息一般是连续产生的，客户端与服务端有互相对话的需求，比较适合采用支持全双工通信的WebSocket来传输。
  3. 一般消息信息可以采用JSON格式，易懂易用，但缺点是信息冗余度比较高，当网络传输带宽达到瓶颈时，我们可以考虑使用Protobuf来对消息编解码，大幅度节省带宽开销。

确定了这两个技术问题，我们就可以着手开始编程了。
下一篇，我们将使用TS来实现一个简单的游戏客户端与服务端应用，以支持玩家的注册登录。







